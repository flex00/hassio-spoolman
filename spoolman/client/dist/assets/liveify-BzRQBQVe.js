import{r as k,N as b,_ as I,aP as E,R as f,d as w,j as o,n as y,m as U,G as A,aL as P,B as O,p as T,aI as L,aE as D,D as H,aJ as z,aQ as M,w as Q}from"./index-DVifsFYV.js";import{t as $,g as R}from"./filtering-CY1b-XQk.js";import{N as Y,a as B}from"./numberField-DPMhgxPK.js";import{u as q}from"./utc-BBX0ZL_c.js";import{e as G}from"./parsing-BWLjJB_7.js";import{F as g}from"./queryFields-mgjQgxCo.js";import{S as K}from"./spoolIcon-C9qHYHAh.js";var W=function(t,n){return k.createElement(b,I({},t,{ref:n,icon:E}))},le=k.forwardRef(W);function X(){try{return localStorage.setItem("test","test"),localStorage.removeItem("test"),!0}catch{return!1}}const d=X();function ue(e){const[t]=f.useState(()=>{const n=j("sorters")?C("sorters"):d?localStorage.getItem(`${e}-sorters`):null,r=j("filters")?C("filters"):d?localStorage.getItem(`${e}-filters`):null,i=j("pagination")?C("pagination"):d?localStorage.getItem(`${e}-pagination`):null,s=d?localStorage.getItem(`${e}-showColumns`):null,a=n?JSON.parse(n):[{field:"id",order:"asc"}],l=r?JSON.parse(r):[],u=i?JSON.parse(i):{page:1,pageSize:20},m=s?JSON.parse(s):void 0;return{sorters:a,filters:l,pagination:u,showColumns:m}});return t}function fe(e,t){f.useEffect(()=>{t.sorters.length>0&&JSON.stringify(t.sorters)!=JSON.stringify([{field:"id",order:"asc"}])?(d&&localStorage.setItem(`${e}-sorters`,JSON.stringify(t.sorters)),v("sorters",JSON.stringify(t.sorters))):(localStorage.removeItem(`${e}-sorters`),F("sorters"))},[e,t.sorters]),f.useEffect(()=>{const n=t.filters.filter(r=>r.value.length!=0);n.length>0?d&&(localStorage.setItem(`${e}-filters`,JSON.stringify(n)),v("filters",JSON.stringify(n))):(localStorage.removeItem(`${e}-filters`),F("filters"))},[e,t.filters]),f.useEffect(()=>{JSON.stringify(t.pagination)!=JSON.stringify({current:1,pageSize:20})?(d&&localStorage.setItem(`${e}-pagination`,JSON.stringify(t.pagination)),v("pagination",JSON.stringify(t.pagination))):(localStorage.removeItem(`${e}-pagination`),F("pagination"))},[e,t.pagination]),f.useEffect(()=>{d&&(t.showColumns===void 0?localStorage.removeItem(`${e}-showColumns`):localStorage.setItem(`${e}-showColumns`,JSON.stringify(t.showColumns)))},[e,t.showColumns])}function ce(e,t){const[n,r]=f.useState(()=>{const i=d?localStorage.getItem(`savedStates-${e}`):null;return i?JSON.parse(i):t});return f.useEffect(()=>{d&&localStorage.setItem(`savedStates-${e}`,JSON.stringify(n))},[e,n]),[n,r]}function v(e,t){const n=new URLSearchParams(window.location.hash.substring(1));n.has(e)||n.append(e,t),n.set(e,t),window.location.hash=n.toString()}function F(e){const t=new URLSearchParams(window.location.hash.substring(1));t.has(e)&&t.delete(e),window.location.hash=t.toString()}function C(e){return new URLSearchParams(window.location.hash.substring(1)).get(e)}function j(e){return new URLSearchParams(window.location.hash.substring(1)).has(e)}function Z(e,t){const n=e.find(r=>r.field===t);if(n)return n.order==="asc"?"ascend":"descend"}w.extend(q);const V=()=>o.jsx(L,{justify:"center",children:o.jsxs(D,{children:["Loading...",o.jsx(z,{style:{margin:10}})]})});function c(e){const t=e.t,n=e.navigate,r=Array.isArray(e.id)?e.id.join("."):e.id;if(e.tableState.showColumns&&!e.tableState.showColumns.includes(r))return;const i={dataIndex:e.id,title:e.title??t(e.i18nkey??`${e.i18ncat}.fields.${e.id}`),filterMultiple:e.allowMultipleFilters??!0,width:e.width??void 0,onCell:e.onCell??void 0};e.sorter&&(i.sorter=!0,i.sortOrder=Z(e.tableState.sorters,e.dataId??e.id)),e.filters&&e.filteredValue&&(i.filters=e.filters,i.filteredValue=e.filteredValue,e.loadingFilters&&(i.filterDropdown=o.jsx(V,{})),i.onFilterDropdownOpenChange=a=>{a&&e.onFilterDropdownOpen&&e.onFilterDropdownOpen()},e.dataId&&(i.key=e.dataId));const s=e.render??(a=>{const l=e.transform?e.transform(a):a;return o.jsx(o.Fragment,{children:l})});return i.render=(a,l,u)=>{if(!e.actions)return s(a,l,u);const m=e.actions(l);return o.jsx(H,{menu:{items:m.map(h=>({key:h.name,label:h.name,icon:h.icon})),onClick:h=>{const S=m.find(_=>_.name===h.key);S&&(S.link?n(S.link):S.onClick&&S.onClick())}},trigger:["click"],children:o.jsx("div",{children:s(a,l,u)})})},i}function me(e){return c({...e,sorter:!0})}function p(e){return c({...e,render:t=>{const n=e.transform?e.transform(t):t;return G(n)}})}function de(e){const t=e.filterValueQuery;let n=[];t.data&&(n=t.data.map(a=>typeof a=="string"?{text:a,value:'"'+a+'"'}:a)),n.push({text:"<empty>",value:"<empty>"});const r=$(e.tableState.filters),i=R(r,e.dataId??e.id);return c({...e,filters:n,filteredValue:i,onFilterDropdownOpen:()=>{t.refetch()},loadingFilters:t.isLoading})}function N(e){return c({...e,render:t=>{const n=e.transform?e.transform(t):t;return n==null?o.jsx(y,{value:e.defaultText??""}):o.jsx(Y,{value:n,unit:e.unit,options:{maximumFractionDigits:e.maxDecimals??0,minimumFractionDigits:e.minDecimals??e.maxDecimals??0}})}})}function ee(e){return c({...e,render:t=>{const n=e.transform?e.transform(t):t;return o.jsx(U,{hidden:!n,value:w.utc(n).local(),title:w.utc(n).local().format(),format:"YYYY-MM-DD HH:mm:ss"})}})}function ge(e){return{title:A()("table.actions"),responsive:["lg"],render:(n,r)=>{const i=e(r).map(s=>{if(s.link)return o.jsx(P,{to:s.link,children:o.jsx(O,{icon:s.icon,title:s.name,size:"small"})},s.name);if(s.onClick)return o.jsx(O,{icon:s.icon,title:s.name,size:"small",onClick:()=>s.onClick()},s.name)});return o.jsx(T,{children:i})}}}function Se(e){const t=e.filterValueQuery;let n=[];t.data&&(n=t.data.map(a=>typeof a=="string"?{text:a,value:'"'+a+'"'}:a)),n.push({text:"<empty>",value:""});const r=$(e.tableState.filters),i=R(r,e.dataId??e.id);return c({...e,filters:n,filteredValue:i,onFilterDropdownOpen:()=>{t.refetch()},loadingFilters:t.isLoading,onCell:()=>({style:{paddingLeft:0,paddingTop:0,paddingBottom:0}}),render:(a,l)=>{const u=e.transform?e.transform(a):a,m=e.color(l);return o.jsxs(L,{wrap:!1,justify:"space-around",align:"middle",children:[m&&o.jsx(D,{flex:"none",children:o.jsx(K,{color:m})}),o.jsx(D,{flex:"auto",children:u})]})}})}function J(e){return c({...e,render:t=>{const n=e.transform?e.transform(t):t;return n==null?o.jsx(y,{value:e.defaultText??""}):!Array.isArray(n)||n.length!==2?o.jsx(y,{value:e.defaultText??""}):o.jsx(B,{value:n,unit:e.unit,options:{maximumFractionDigits:e.maxDecimals??0,minimumFractionDigits:e.minDecimals??e.maxDecimals??0}})}})}function he(e){const t=e.field,n={...e,id:["extra",t.key],title:t.name,sorter:!1,transform:r=>{if(r!=null)return JSON.parse(r)}};return t.field_type===g.integer?N({...n,unit:t.unit??"",maxDecimals:0}):t.field_type===g.float?N({...n,unit:t.unit??"",minDecimals:0,maxDecimals:3}):t.field_type===g.integer_range?J({...n,unit:t.unit??"",maxDecimals:0}):t.field_type===g.float_range?J({...n,unit:t.unit??"",minDecimals:0,maxDecimals:3}):t.field_type===g.text?p({...n}):t.field_type===g.datetime?ee({...n}):t.field_type===g.boolean?c({...n,render:r=>{const i=n.transform?n.transform(r):r;let s;return i==null?s="":i?s=e.t("yes"):s=e.t("no"),o.jsx(y,{value:s})}}):t.field_type===g.choice&&!t.multi_choice?c({...n,render:r=>{const i=n.transform?n.transform(r):r;return o.jsx(y,{value:i})}}):t.field_type===g.choice&&t.multi_choice?c({...n,render:r=>{const i=n.transform?n.transform(r):r;return o.jsx(y,{value:i==null?void 0:i.join(", ")})}}):c({...n,render:r=>{const i=n.transform?n.transform(r):r;return o.jsx(y,{value:i})}})}const x=M(Q());function ye(e,t,n){const[r,i]=f.useState(t);f.useEffect(()=>{i(t)},[t]);const s=t.map(u=>u.id),[a,l]=f.useState(s);return JSON.stringify(s)!==JSON.stringify(a)&&l(s),f.useEffect(()=>{const u=x==null?void 0:x.subscribe({channel:`${e}-list`,params:{resource:e,ids:a,subscriptionType:"useList"},types:["update"],callback:m=>{i(h=>h.map(S=>S.id===m.payload.data.id?n(m.payload.data):S))}});return()=>{u&&(x==null||x.unsubscribe(u))}},[e,a,n]),r}export{ge as A,he as C,ee as D,de as F,N,le as R,me as S,fe as a,ye as b,Se as c,p as d,ce as e,ue as u};

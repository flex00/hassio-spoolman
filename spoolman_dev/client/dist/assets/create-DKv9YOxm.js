import{F as a,G as F,j as e,M as A,d as L,R as h,C as O,T as B,a as k,V as M,B as j,I as _,b as R,c as G}from"./index-DVifsFYV.js";import{n as b,a as g}from"./parsing-BWLjJB_7.js";import{u as P,E as N}from"./queryFields-mgjQgxCo.js";import{E as D,S as H}from"./extraFields-qtPcbZeu.js";import{u as J}from"./utc-BBX0ZL_c.js";import{u as K,g as z}from"./settings-CgMC_ZgH.js";import{u as Q,f as U}from"./functions-D0sxzadJ.js";import{s as W}from"./filtering-CY1b-XQk.js";import{T as X}from"./Trans-BPjU-PT-.js";import{S as C}from"./index-fxb4jQRc.js";import{g as Y}from"./functions-CK5Ek87f.js";import{C as Z,M as $}from"./multiColorPicker-Bsf9hzQ8.js";import{R as c}from"./index-CPB1sIE8.js";import{T as o}from"./index-Bg14sNK-.js";import"./numberField-DPMhgxPK.js";import"./inputNumberRange-BgK2w3SK.js";import"./querySettings-CUjj6H0m.js";import"./ColorPicker-AWLASrGN.js";import"./Collapse-CsNDAcKW.js";import"./index-CWobl7yM.js";function ee(m){var d;const[t]=a.useForm(),f=F(),p=((d=Q().data)==null?void 0:d.map(s=>({label:U(s.name,s.diameter,s.manufacturer,s.material,s.weight,s.spool_type),value:s.id,item:s})))??[];return p.sort((s,i)=>s.label.localeCompare(i.label,void 0,{sensitivity:"base"})),e.jsx(A,{title:f("filament.form.import_external"),open:m.isOpen,onOk:()=>t.submit(),onCancel:()=>m.onClose(),children:e.jsxs(a,{layout:"vertical",form:t,onFinish:s=>{var x;const i=(x=p.find(u=>u.value===s.filament))==null?void 0:x.item;if(!i)throw new Error("Filament not found");m.onImport(i),m.onClose(),t.resetFields()},children:[e.jsx("p",{children:e.jsx(X,{i18nKey:"filament.form.import_external_description",components:{br:e.jsx("br",{})}})}),e.jsx(a.Item,{name:"filament",rules:[{required:!0}],children:e.jsx(C,{options:p,showSearch:!0,filterOption:(s,i)=>typeof(i==null?void 0:i.label)=="string"&&W(s,i==null?void 0:i.label)})})]})})}L.extend(J);const ye=m=>{var I;const t=F(),f=P(N.filament),y=K(),[p,d]=h.useState(!1),s=O(),[i,x]=h.useState("single"),{form:u,formProps:n,formLoading:w,onFinish:q,redirect:V}=B();n.initialValues||(n.initialValues={}),m.mode==="clone"&&n.initialValues.vendor&&(n.initialValues.vendor_id=n.initialValues.vendor.id);const v=async r=>{const l=H(await u.validateFields());await q(l),V(r)},{selectProps:E}=k({resource:"vendor",optionLabel:"name"}),S=async r=>{const l=await Y(r.manufacturer);await s({resource:"vendor",invalidates:["list","detail"]}),u.setFieldsValue({name:r.name,vendor_id:l.id,material:r.material,density:r.density,diameter:r.diameter,weight:r.weight,spool_weight:r.spool_weight||void 0,color_hex:r.color_hex,settings_extruder_temp:r.extruder_temp||void 0,settings_bed_temp:r.bed_temp||void 0})};return h.useEffect(()=>{var r;(r=f.data)==null||r.forEach(l=>{if(n.initialValues&&l.default_value){const T=JSON.parse(l.default_value);u.setFieldsValue({extra:{[l.key]:T}})}})},[u,f.data,n.initialValues]),e.jsxs(M,{title:m.mode==="create"?t("filament.titles.create"):t("filament.titles.clone"),isLoading:w,headerButtons:()=>e.jsx(e.Fragment,{children:e.jsx(j,{type:"primary",onClick:()=>d(!0),children:t("filament.form.import_external")})}),footerButtons:()=>e.jsxs(e.Fragment,{children:[e.jsx(j,{type:"primary",onClick:()=>v("list"),children:t("buttons.save")}),e.jsx(j,{type:"primary",onClick:()=>v("create"),children:t("buttons.saveAndAdd")})]}),children:[e.jsx(ee,{isOpen:p,onImport:r=>{d(!1),S(r)},onClose:()=>d(!1)}),e.jsxs(a,{...n,layout:"vertical",children:[e.jsx(a.Item,{label:t("filament.fields.name"),help:t("filament.fields_help.name"),name:["name"],rules:[{required:!1}],children:e.jsx(_,{maxLength:64})}),e.jsx(a.Item,{label:t("filament.fields.vendor"),name:["vendor_id"],rules:[{required:!1}],children:e.jsx(C,{...E,allowClear:!0,filterSort:(r,l)=>r!=null&&r.label&&(l!=null&&l.label)?r.label.localeCompare(l.label,void 0,{sensitivity:"base"}):0,filterOption:(r,l)=>typeof(l==null?void 0:l.label)=="string"&&(l==null?void 0:l.label.toLowerCase().includes(r.toLowerCase()))})}),e.jsx(a.Item,{label:t("filament.fields.color_hex"),children:e.jsxs(c.Group,{onChange:r=>{x(r.target.value)},defaultValue:i,value:i,children:[e.jsx(c.Button,{value:"single",children:t("filament.fields.single_color")}),e.jsx(c.Button,{value:"multi",children:t("filament.fields.multi_color")})]})}),i=="single"&&e.jsx(a.Item,{name:"color_hex",rules:[{required:!1}],getValueFromEvent:r=>r==null?void 0:r.toHex(),children:e.jsx(Z,{format:"hex"})}),i=="multi"&&e.jsx(a.Item,{name:"multi_color_direction",help:t("filament.fields_help.multi_color_direction"),rules:[{required:!0}],initialValue:"coaxial",children:e.jsxs(c.Group,{children:[e.jsx(c.Button,{value:"coaxial",children:t("filament.fields.coaxial")}),e.jsx(c.Button,{value:"longitudinal",children:t("filament.fields.longitudinal")})]})}),i=="multi"&&e.jsx(a.Item,{name:"multi_color_hexes",rules:[{required:!1}],children:e.jsx($,{min:2,max:14})}),e.jsx(a.Item,{label:t("filament.fields.material"),help:t("filament.fields_help.material"),name:["material"],rules:[{required:!1}],children:e.jsx(_,{maxLength:64})}),e.jsx(a.Item,{label:t("filament.fields.price"),help:t("filament.fields_help.price"),name:["price"],rules:[{required:!1,type:"number",min:0}],children:e.jsx(o,{addonAfter:z(void 0,y),precision:2,formatter:b,parser:g})}),e.jsx(a.Item,{label:t("filament.fields.density"),name:["density"],rules:[{required:!0,type:"number",min:0,max:100}],children:e.jsx(o,{addonAfter:"g/cm³",precision:2,formatter:b,parser:g})}),e.jsx(a.Item,{label:t("filament.fields.diameter"),name:["diameter"],rules:[{required:!0,type:"number",min:0,max:10}],children:e.jsx(o,{addonAfter:"mm",precision:2,formatter:b,parser:g})}),e.jsx(a.Item,{label:t("filament.fields.weight"),help:t("filament.fields_help.weight"),name:["weight"],rules:[{required:!1,type:"number",min:0}],children:e.jsx(o,{addonAfter:"g",precision:1})}),e.jsx(a.Item,{label:t("filament.fields.spool_weight"),help:t("filament.fields_help.spool_weight"),name:["spool_weight"],rules:[{required:!1,type:"number",min:0}],children:e.jsx(o,{addonAfter:"g",precision:1})}),e.jsx(a.Item,{label:t("filament.fields.settings_extruder_temp"),name:["settings_extruder_temp"],rules:[{required:!1,type:"number",min:0}],children:e.jsx(o,{addonAfter:"°C",precision:0})}),e.jsx(a.Item,{label:t("filament.fields.settings_bed_temp"),name:["settings_bed_temp"],rules:[{required:!1,type:"number",min:0}],children:e.jsx(o,{addonAfter:"°C",precision:0})}),e.jsx(a.Item,{label:t("filament.fields.article_number"),help:t("filament.fields_help.article_number"),name:["article_number"],rules:[{required:!1}],children:e.jsx(_,{maxLength:64})}),e.jsx(a.Item,{label:t("filament.fields.comment"),name:["comment"],rules:[{required:!1}],children:e.jsx(R,{maxLength:1024})}),e.jsx(G.Title,{level:5,children:t("settings.extra_fields.tab")}),(I=f.data)==null?void 0:I.map((r,l)=>e.jsx(D,{field:r},l))]})]})};export{ye as FilamentCreate,ye as default};
